<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Update Harga Pasar</title>
<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
form{background:white;padding:20px;border-radius:10px;max-width:500px;margin:auto}
input,select,textarea,button{
 width:100%;padding:10px;margin-top:8px
}
button{background:#4CAF50;color:white;border:none}
</style>
</head>

<body>

<form id="form">
<h3>UPDATE HARGA PASAR</h3>

<input name="surveyor" placeholder="Nama Surveyor" required>

<select name="komoditas" required>
<option value="">Pilih Komoditas</option>
<option>Beras</option>
<option>Cabai</option>
<option>Tomat</option>
<option>Ayam</option>
</select>

<select name="satuan">
<option>Kg</option>
<option>Ikat</option>
<option>Ekor</option>
</select>

<select name="kualitas">
<option>Premium</option>
<option>Medium</option>
<option>Rendah</option>
</select>

<input name="harga" placeholder="Harga">

<textarea name="catatan" placeholder="Catatan"></textarea>

<input type="file" id="foto" accept="image/*">

<button>Kirim</button>
</form>

<script>
const API = "https://script.google.com/macros/s/AKfycbyHjIYO63uJE2lYRozX6h927zjDCQm83bqUbWxEfHoO_398GoeOhcEI_wZfzCciwTsusA/exec";

document.getElementById("form").onsubmit = async(e)=>{
 e.preventDefault();

 let f = e.target;
 let file = document.getElementById("foto").files[0];

 if(!file){
   alert("Foto wajib diupload!");
   return;
 }

 // compress dulu
 let base64 = await compressImage(file, 1200, 0.7);

 let data = {
  surveyor:f.surveyor.value,
  komoditas:f.komoditas.value,
  satuan:f.satuan.value,
  kualitas:f.kualitas.value,
  harga:f.harga.value,
  catatan:f.catatan.value,
  dokumentasi:base64
 };

 fetch(API,{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(data)
 })
 .then(r=>r.text())
 .then(t=>{
   alert("Berhasil dikirim");
   f.reset();
 })
 .catch(err=>{
   alert("Gagal kirim");
   console.log(err);
 });
}

// ===== COMPRESS =====
function compressImage(file, maxWidth, quality){
 return new Promise(resolve=>{
  const reader = new FileReader();
  reader.onload = e=>{
    const img = new Image();
    img.onload = ()=>{
      let canvas = document.createElement("canvas");
      let ratio = img.width / img.height;

      canvas.width = maxWidth;
      canvas.height = maxWidth / ratio;

      let ctx = canvas.getContext("2d");
      ctx.drawImage(img,0,0,canvas.width,canvas.height);

      let base64 = canvas.toDataURL("image/jpeg", quality);
      resolve(base64);
    }
    img.src = e.target.result;
  }
  reader.readAsDataURL(file);
 })
}
</script>



</body>
</html>


