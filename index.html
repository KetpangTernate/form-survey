<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Update Harga Pasar</title>
<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
form{background:white;padding:20px;border-radius:10px;max-width:500px;margin:auto}
input,select,textarea,button{
 width:100%;padding:10px;margin-top:8px
}
button{background:#4CAF50;color:white;border:none}
</style>
</head>

<body>

<form id="form">
<h3>UPDATE HARGA PASAR</h3>

<input name="surveyor" placeholder="Nama Surveyor" required>

<select name="komoditas" required>
<option value="">Pilih Komoditas</option>
<option>Beras</option>
<option>Cabai</option>
<option>Tomat</option>
<option>Ayam</option>
</select>

<select name="satuan">
<option>Kg</option>
<option>Ikat</option>
<option>Ekor</option>
</select>

<select name="kualitas">
<option>Premium</option>
<option>Medium</option>
<option>Rendah</option>
</select>

<input name="harga" placeholder="Harga">

<textarea name="catatan" placeholder="Catatan"></textarea>

<input type="file" id="foto" accept="image/*">

<button>Kirim</button>
</form>

<script>
const API = "https://script.google.com/macros/s/AKfycbyHjIYO63uJE2lYRozX6h927zjDCQm83bqUbWxEfHoO_398GoeOhcEI_wZfzCciwTsusA/exec";

document.getElementById("form").onsubmit = async(e)=>{
 e.preventDefault();

 let f = e.target;
 let file = document.getElementById("foto").files[0];

 if(!file){
   alert("Foto wajib diupload!");
   return;
 }

 // batasi ukuran
 if(file.size > 2000000){
   alert("Ukuran foto max 2MB");
   return;
 }

 let base64 = await toBase64(file);

 let data = {
  surveyor:f.surveyor.value,
  komoditas:f.komoditas.value,
  satuan:f.satuan.value,
  kualitas:f.kualitas.value,
  harga:f.harga.value,
  catatan:f.catatan.value,
  dokumentasi:base64
 };

 fetch(API,{
  method:"POST",
  headers:{
    "Content-Type":"application/json"
  },
  body:JSON.stringify(data)
 })
 .then(r=>r.text())
 .then(t=>{
   alert("Berhasil dikirim");
   console.log(t);
   f.reset();
 })
 .catch(err=>{
   alert("Gagal kirim");
   console.log(err);
 });
}

function toBase64(file){
 return new Promise((res)=>{
  let r = new FileReader();
  r.onload = ()=>res(r.result);
  r.readAsDataURL(file);
 })
}
</script>


</body>
</html>

